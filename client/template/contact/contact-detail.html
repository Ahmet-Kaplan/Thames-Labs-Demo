<template name="contactDetail">
  {{#with contactData}} {{setPageTitle "Contact - " name }}
  <div class="row">
    <div class="col-md-1 hidden-sm hidden-xs">
      {{> jumplist list=linksList}}
    </div>
    <div class="col-md-7">
       {{#if metadata.clearbit.avatar}}
      <img class="img-circle avatar pull-right" src="{{metadata.clearbit.avatar}}" /> {{/if}}


      <h4 class="entity-title">Contact {{> watchlistAdmin entityData=this collection="contacts"}}</h4>
      <h1 id="contact-details" class="entity-name">{{#if showTitle}}{{title}} {{/if}}{{name}}</h1>
      {{> tagInput tags=tags collection='contacts' entityId=_id permissionToEdit='CanEditContacts'}}
      <div class="panel panel-default" id="contact-detail-panel">
        <div class="panel-heading">
          <div class="btn-group pull-right">
            {{#if isInRole 'CanEditContacts'}}
              {{#unless isMobile}}
            <a href="#" id="edit-contact" class="btn btn-info btn-xs"><i class="fa fa-fw fa-pencil"></i>Edit</a>{{/unless}}{{/if}} {{#if isInRole 'CanDeleteContacts'}}
            <a href="#" id="remove-contact" class="btn btn-danger btn-xs"><i class="fa fa-fw fa-times"></i>Delete</a>{{/if}}
          </div>
          Contact
        </div>
        <ul class="list-group">
          {{#if company}} {{#if isInRole 'CanReadCompanies'}}
          <a href="{{pathFor route='company' id=company._id}}" class="list-group-item panel-item-header" data-toggle="tooltip" data-placement="bottom" title="Navigate to company details">
            <h4><i class="fa fa-fw fa-building"></i> Company</h4>
            <i class="fa fa-fw fa-chevron-right pull-right"></i>
            <p class="list-group-item-text">{{company.name}}</p>
          </a>
          {{/if}} {{/if}} {{#if jobtitle}}
          <li class="list-group-item panel-item-header">
            <h4><i class="fa fa-fw fa-graduation-cap"></i> Job Title</h4>
            <p class="list-group-item-text">{{jobtitle}}</p>
          </li>
          {{/if}} {{#if email}}
          <a href="mailto:{{email}}" class="list-group-item panel-item-header">
            <h4><i class="fa fa-fw fa-envelope"></i> Email</h4>
            <p class="list-group-item-text">{{email}}</p>
          </a>
          {{/if}} {{#if phone}}
          <a href="{{phoneHref phone}}" id="contactTelephone" class="list-group-item panel-item-header" data-toggle="tooltip" data-placement="bottom" title="">
            <h4><i class="fa fa-fw fa-phone"></i> Phone Number</h4>
            <i class="fa fa-fw fa-chevron-right pull-right"></i>
            <p class="list-group-item-text">{{phone}}</p>
          </a>
          {{/if}} {{#if mobile}}
          <a href="{{phoneHref mobile}}" class="list-group-item panel-item-header" data-toggle="tooltip" data-placement="bottom" title="">
            <h4><i class="fa fa-fw fa-mobile"></i> Mobile Number</h4>
            <i class="fa fa-fw fa-chevron-right pull-right"></i>
            <p class="list-group-item-text">{{mobile}}</p>
          </a>
          {{/if}}
          <li class="list-group-item panel-item-header">
            <h4><i class="fa fa-fw fa-hashtag"></i> RealTime Contact ID</h4>
            <p class="list-group-item-text">{{sequencedIdentifier}}</p>
          </li>
        </ul>
      </div>

      <div>
        {{#if isInRole 'CanEditContacts'}}{{#with this}} {{> customFieldDisplay entity_data=this entity_type='contact'}} {{/with}}{{/if}}
      </div>

      {{#if isInRole 'CanReadProjects'}}
      <div class="panel panel-default">
        <div class="panel-heading" id="projects">
          Projects {{#if isInRole 'CanCreateProjects'}}
          <a href="#" id="add-project" class="btn btn-primary btn-xs pull-right" data-toggle="tooltip" data-placement="bottom" title="New project for this contact"><i class="fa fa-fw fa-plus"></i> Add</a> {{/if}}
        </div>
        <ul class="list-group">
          {{#each projects}} {{> ContactProjectListItem}} {{else}}
          <li class="list-group-item">No projects</li>
          {{/each}}
        </ul>
      </div>
      {{/if}}

      {{#if isInRole 'CanReadPurchaseOrders'}}
      <div class="panel panel-default">
        <div class="panel-heading" id="purchase-orders">
          Purchase Orders{{#if isInRole 'CanCreatePurchaseOrders'}}
           <a href="#" id="add-purchase-order" class="btn btn-primary btn-xs pull-right" data-toggle="tooltip" data-placement="bottom" title="New purchase order for this contact"><i class="fa fa-fw fa-plus"></i> Add</a> {{/if}}
        </div>
        <ul class="list-group">
          {{#each purchaseOrders}}
          <a href="{{pathFor route='purchaseOrder' id=_id}}" class="list-group-item">
            <i class="fa fa-fw fa-shopping-cart"></i> {{description}}
            <i class="fa fa-fw fa-chevron-right pull-right"></i>
          </a> {{else}}
          <li class="list-group-item">No purchase orders</li>
          {{/each}}
        </ul>
      </div>
      {{/if}}

{{> documentContainer collectionName="contacts" id=this._id permissionRequired="CanEditContacts"}}

      {{#if isInRole 'CanReadTasks'}} {{#with this}} {{> taskDisplay entity_type="contact" entity_id=_id}} {{/with}}{{/if}}


      {{#if isInRole 'CanReadOpportunities'}}
      <div class="panel panel-default">
        <div class="panel-heading" id="opportunities">
          Opportunities {{#if isInRole 'CanCreateOpportunities'}}
          <a href="#" id="add-opportunity" class="btn btn-primary btn-xs pull-right" data-toggle="tooltip" data-placement="bottom" title="New opportunity for this company"><i class="fa fa-fw fa-plus"></i> Add</a> {{/if}}
        </div>
        <ul class="list-group">
          {{#each opportunities}}
          <a href="{{pathFor route='opportunity' id=_id}}" class="list-group-item">
            <i class="fa fa-fw fa-lightbulb-o"></i> {{name}}
            <i class="fa fa-fw fa-chevron-right pull-right"></i>
          </a>
          {{else}}
          <li class="list-group-item">No opportunities</li>
          {{/each}}
        </ul>
      </div>
      {{/if}}
    </div>

    <div class="col-md-4">
      {{> publicContactInformation}}
      <h4>Address</h4>
      {{> map title=mapTitle address=mapAddress}}
    </div>

  </div>

  <div class="row">
    <div class="col-md-11 col-md-offset-1">
      <h1 id="activity-timeline">
        Activity Timeline
        <a href="#" class="btn btn-primary{{#unless isMobile}} pull-right{{/unless}}" data-toggle="tooltip" data-placement="bottom" title="New activity for this contact" id="add-activity"><i class="fa fa-fw fa-plus"></i> Add activity</a>
      </h1>
      {{> activityTimeline activities=activities}}
    </div>
  </div>

  {{#if isInRole 'CanEditContacts'}}
    {{#if isMobile}}
      <div class="fab edit" id="fab">
        <i class="fa fw-fa fa-pencil"></i>
      </div>
    {{/if}}
  {{/if}}


  {{> autoformModals}} {{/with}}
</template>

<template name="ContactProjectListItem">
  <a href="{{pathFor route='project' id=_id}}" class="list-group-item">
    <div class="row">
      <div class="col-md-8">
        <i class="fa fa-fw fa-sitemap"></i> {{name}}
      </div>
      <div class="col-md-3 userDataDisplay">
        {{#if companyProject}}<i class="fa fa-fw fa-building"></i> {{projectCompanyName}}{{/if}}
      </div>
      <div class="col-md-1">
        <i class="fa fa-fw fa-chevron-right pull-right"></i>
      </div>
    </div>
  </a>
</template>
