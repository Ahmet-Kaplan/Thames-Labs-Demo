<template name="tenancyAdminPage">

  {{setPageTitle "Administration" }}

  <h1 id="admin-header">
    <i class="fa fa-fw fa-cogs" id="admin-logo"></i>
    Administration</h1>

  <div class="row">
    <div class="col-md-10 col-md-offset-1">

      {{#if tenantFound}}
      <div class="panel panel-primary" id="stripeAdminPanel">
        <div class="panel-heading ">Plan</div>
        <div class="panel-body" id="tenancyStripe">
          {{#if isFreeProTenant }}
            <h4>You are currently on the Pro plan</h4>
            <p>To make changes to your account please contact <a href="mailto:support@cambridgesoftware.co.uk">support@cambridgesoftware.co.uk</a>.</p>
          {{else}}
            {{> stripeAdmin}}
          {{/if}}
        </div>
      </div>
      {{/if}}

      {{> dataDumpPanel}}

      {{> generalSettings}}

      <div class="panel panel-primary" id="userAdminPanel">
        <div class="panel-heading">
          <a class="accordion-toggle" data-parent="#accordion" data-toggle="collapse" href="#colUsers" id="userAdminPanelExpander">Users</a>
        </div>
        <div class="panel-collapse collapse" id="colUsers">
          <div class="panel-body" id="tenancyUsers">

            <div class="well well-sm">
              <button class="btn btn-xs btn-primary" id="addNewUserAccount" role="button" type="button">
                <i class="fa fa-fw fa-plus"></i>
                Add new user
              </button>
            </div>

            <ul class="list-group" id="user-list">
              {{#each tenantUsers}}
                {{> adminAreaUser}}
              {{/each}}
            </ul>

          </div>
        </div>
      </div>

        {{> contactAdminPanel}}
        {{> oppStagePanel}}
        {{> projectAdmin}}
        {{> purchaseOrderAdminPanel}}

      <div class="panel panel-primary" id="globalCustomFieldsPanel">
        <div class="panel-heading ">
          <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#globCustFields" id="globCustomFieldsExpander">Global Custom Fields</a>
        </div>
        <div id="globCustFields" class="panel-collapse collapse">
          <div class="panel-body">

            <div class="row">
              <div class="col-md-12">
                <div class="well well-sm">
                  <button type="button" class="btn btn-xs btn-primary" role="button" id="addGlobalCustomField">
                    <i class="fa fa-fw fa-plus"></i> Add new global field
                  </button>
                </div>
              </div>
            </div>

            <div class="list-group" id="custom-field-list">

              <div class="well well-sm">
                <h4>Companies</h4>
                {{#each globalCompanyCustomFields}} {{> gcf_display}} {{/each}}
              </div>

              <div class="well well-sm">
                <h4>Contacts</h4>
              {{#each globalContactCustomFields}} {{> gcf_display}} {{/each}}
            </div>

              <div class="well well-sm">
                <h4>Projects</h4>
              {{#each globalProjectCustomFields}} {{> gcf_display}} {{/each}}
            </div>

              <div class="well well-sm">
                <h4>Products</h4>
                {{#each globalProductCustomFields}} {{> gcf_display}} {{/each}}
              </div>

            </div>

          </div>
        </div>
      </div>

      <div class="panel panel-danger" id="accountDeletePanel">
        <div class="panel-heading">
          <a class="accordion-toggle" data-parent="#accordion" data-toggle="collapse" href="#colAccDel" id="accountDeletionPanelExpander">Delete My Company Account</a>
        </div>
        <div class="panel-collapse collapse" id="colAccDel">
          <div class="panel-body" id="accDelPanelBody">

            <div class="well well-sm">
              <p><h3>WARNING!</h3> This action will flag your company's RealTimeCRM account for deletion. Once deleted, all data associated with it will be permanently lost and cannot be recovered. You will be asked to confirm your password in order to proceed, and your Stripe subscription (if any) will be cancelled immediately.</p>
              <button class="btn btn-danger" id="deleteUserAccount" role="button" type="button">
                <i class="fa fa-fw fa-times"></i>
                Delete my account
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

</template>

<template name="gcf_display">
  <div class="list-group-item" id="glob-cust-field-display">
    <div class="row">
      {{#unless equals type 'label'}}
      <div class="col-md-3">
          Name: {{name}} ({{niceType}})
      </div>
      <div class="col-md-3">
        {{#if equals type 'picklist'}}
          Value List: {{listValues}}
        {{else}}
          Default Value: {{#if equals type 'advtext'}} {{{value}}} {{else}} {{value}} {{/if}}
        {{/if}}
      </div>
      {{else}}
      <div class="col-md-6">
          Label: <strong>{{name}}</strong>
      </div>
      {{/unless}}
      <div class="col-md-3">
        {{#if canMove}}
          <span class="pull-right">
              <i id="orderUp" class="fa fa-fw fa-arrow-up {{#if canMoveUp}} orderEnabled {{else}} orderDisabled {{/if}}" ></i>
              <i id="orderDown" class="fa fa-fw fa-arrow-down  {{#if canMoveDown}} orderEnabled {{else}} orderDisabled {{/if}}" ></i>
          </span>
        {{/if}}
      </div>
      <div class="col-md-3">
        <button id='delete-global-custom-field' class="btn btn-danger btn-xs pull-right" type="button"><i class="fa fa-fw fa-times"></i></button>
      </div>
    </div>
  </div>
</template>

<template name="adminAreaUser">
  <div class="list-group-item">
    <div class="row">
      <div class="col-md-3">{{profile.name}}
      </div>
      <div class="col-md-3 col-md-offset-1"></div>
      <div class="col-md-4">
        <div class="btn-group btn-group-justified pull-right" role="group">

          <div class="btn-group" role="group">
            <button class="btn btn-primary btn-xs" id="btnEditTenantUserGeneralSettings" type="button">
              <i class="fa fa-fw fa-cogs"></i>
              Settings
            </button>
          </div>

          <div class="btn-group" role="group">
            <button class="btn btn-info btn-xs" id="btnEditTenantUserPermissions" type="button">
              <i class="fa fa-fw fa-pencil"></i>
              Permissions
            </button>
          </div>

          <div class="btn-group" role="group">
            <button class="btn btn-danger btn-xs" disabled="{{#if isSelf}}disabled{{/if}}" id="tenantRemoveUser" type="button">
              <i class="fa fa-fw fa-times"></i>
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
