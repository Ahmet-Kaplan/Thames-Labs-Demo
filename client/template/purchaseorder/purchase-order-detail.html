<template name="purchaseOrderDetail">
  {{#with purchaseOrderData}}
    {{setPageTitle "Purchase order - " description}}
    <div class="row">
      <div class="col-md-2 hidden-xs hidden-sm">
        <div class="sidebar">
          <h1>Actions</h1>
          <ul class="nav nav-stacked">
            <li>
              <a href="#purchase-order-details">Purchase Order details</a>
            </li>
            <li>
              <a href="#activity-timeline">Activity timeline</a>
            </li>
          </ul>
          <div class="btn-group">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">
              Export purchase order
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu">
              {{#if canExportDocx}}
                <li>
                  <a href="#" id="template-upload-link-docx">Word document (.docx)</a>
                </li>
              {{/if}}
              <li>
                <a href="#" id="template-upload-link">PDF (.pdf)</a>
              </li>
              <li class="divider"></li>
              <li>
                <a href="#" id="po-template-help">How does this work?</a>
              </li>
            </ul>
          </div>
          <input id="template-upload-docx" style="height:0; width: 0; margin-left: -9999px" type="file">
          <input id="template-upload" style="height:0; width: 0; margin-left: -9999px" type="file">
        </div>
      </div>
      <div class="col-md-10">
        <h4 class="entity-title">Purchase Order</h4>
        <h1 class="entity-name" id="purchase-order-details">{{description}}</h1>

<!-- {{> tagInput}} -->

        <div class="panel panel-default">
          <div class="panel-heading">
            <div class="btn-group pull-right">
              {{#if isInRole 'Administrator,CanEditPurchaseOrders'}}
                <a class="btn btn-info btn-xs" disabled="{{#unless isOpen}}disabled{{/unless}}" href="#" id="edit-purchase-order">Edit purchase order details</a>
              {{/if}}
              {{#if isInRole 'Administrator,CanDeletePurchaseOrders'}}
                <a class="btn btn-danger btn-xs" href="#" id="remove-purchase-order">Delete purchase order</a>
              {{/if}}
            </div>
            Details</div>
          <ul class="list-group">
            {{#if supplierCompany}}
              {{#if isInRole 'Administrator,CanReadCompanies'}}
                <a class="list-group-item" data-placement="bottom" data-toggle="tooltip" href="{{pathFor route='company' id=supplierCompany._id}}" title="Navigate to supplier company details">
                  <i class="fa fa-fw fa-building"></i>
                  Supplier:
                  {{supplierCompany.name}}
                  <i class="fa fa-fw fa-chevron-right pull-right"></i>
                </a>
              {{/if}}
            {{/if}}
            {{#if supplierContact}}
              {{#if isInRole 'Administrator,CanReadContacts'}}
                <a class="list-group-item" data-placement="bottom" data-toggle="tooltip" href="{{pathFor route='contact' id=supplierContact._id}}" title="Navigate to supplier contact details">
                  <i class="fa fa-fw fa-user"></i>
                  Supplier Contact:
                  {{supplierContact.forename}}
                  {{supplierContact.surname}}
                  <i class="fa fa-fw fa-chevron-right pull-right"></i>
                </a>
              {{/if}}
            {{/if}}

            <li class="list-group-item">
              <i class="fa fa-fw fa-bullseye"></i>
              Order Number:
              {{orderNumber}}
            </li>
            <li class="list-group-item">
              <i class="fa fa-fw fa-question"></i>
              Status:
              {{status}}
            </li>
            <li class="list-group-item">
              <i class="fa fa-fw fa-calendar"></i>
              Order Date:
              {{orderDate}}
            </li>
            <li class="list-group-item">
              <i class="fa fa-fw fa-pencil"></i>
              Supplier Reference:
              {{supplierReference}}
            </li>
            <li class="list-group-item">
              <i class="fa fa-fw fa-credit-card"></i>
              Payment Method:
              {{paymentMethod}}
            </li>
            <li class="list-group-item">
              <i class="fa fa-fw fa-paperclip"></i>
              Notes:
              {{notes}}
            </li>
          </ul>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            {{#if isInRole 'Administrator,CanEditPurchaseOrders'}}
              <div class="btn-group pull-right">
                <a class="btn btn-primary btn-xs" data-placement="bottom" data-toggle="tooltip" disabled="{{#unless canAddMoreItems}}disabled{{/unless}}" href="#" id="add-item" title="New task for this purchase order">
                  <i class="fa fa-fw fa-plus"></i>
                  Add item</a>
              </div>
            {{/if}}
            Items</div>
          <div class="panel-body">
            <ul class="list-group">
              {{#if hasItems}}
                {{#each purchaseOrderItems}}
                  {{> purchaseOrderItem}}
                {{/each}}
                {{else}}
                <li class="list-group-item">
                  <em>No items</em>
                </li>
              {{/if}}
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-3"></div>
    </div>
    <div class="row">
      <div class="col-md-10 col-md-offset-2">
        <h1 id="activity-timeline">
          Activity Timeline
          <a class="btn btn-primary pull-right" data-placement="bottom" data-toggle="tooltip" href="#" id="add-activity" title="New activity for this purchase order">
            <i class="fa fa-fw fa-plus"></i>
            Add activity</a>
        </h1>
        {{> activityTimeline activities=activities}}
      </div>
    </div>
    {{> autoformModals}}
  {{/with}}
</template>

<template name="purchaseOrderItem">
<li class="list-group-item .po-item">
  <div class="row">

    <div class="col-md-4">
      <i class="fa fa-fw fa-archive"></i>
      {{description}}
    </div>
    <div class="col-md-2" style="color:#BABABA;">
      <i class="fa fa-fw fa-tag"></i>
      {{productCode}}
    </div>
    <div class="col-md-2" style="color:#BABABA;">
      <i class="fa fa-fw fa-files-o"></i>
      {{projectName}}
    </div>
    <div class="col-md-2">
      <i class="{{statusIcon}}"></i>
      {{orderItemStatus}}
    </div>
    <div class="col-md-1">
      <i class="fa fa-fw fa-money"></i>
      {{decimal totalPrice}}
    </div>
    <div class="col-md-1">
      <div class="btn-group btn-group-justified" role="group">
        <div class="btn-group " role="group">
          <button class="btn btn-xs btn-info" data-placement="bottom" data-toggle="tooltip" disabled="{{#unless canAddMoreItems ..}}disabled{{/unless}}" id="edit-po-item" role="button" title="Edit purchase order item">
            <i class="fa fa-fw fa-pencil"></i>
          </button>
        </div>
        <div class="btn-group" role="group">
          <button class="btn btn-xs btn-danger" data-placement="bottom" data-toggle="tooltip" disabled="{{#unless canAddMoreItems ..}}disabled{{/unless}}" id="removePurchaseOrderItem" role="button" title="Delete purchase order item">
            <i class="fa fa-fw fa-times"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</li>
</template>

<template name="poHelpModal">
<div class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button aria-hidden="true" class="close" data-dismiss="modal" type="button">Ã—</button>
        <h4>Help on templates</h4>
      </div>
      <div class="modal-body">
        <p>You can create a template by using Word, creating a new document, populating it with your content and include Keywords that RealTime recognises which will allow RealTime to personalise and fill your template for you. You can then upload your
          template whenever you need to use it and save time.</p>
        <p>Keywords which are recognised by RealTime:</p>
        <ul>
          <li>{customerName} - Company name</li>
          <li>{customerContact} - Company contact name (if provided)</li>
          <li>{customerAddress} - Company address</li>

          <li>{orderNumber} - The purchase order number</li>
          <li>{orderDate} - The date that the template is generated on</li>
        </ul>

        For each purchase order item, you can specify the following tags:
        <ul>
          <li>{name} - The name of a purchase order item</li>
          <li>{count} - The number of a purchase order items ordered</li>
          <li>{value} - The value of a purchase order item</li>
          <li>{total} - The total cost of this purchase order item, dependent on quantity</li>
        </ul>
        You can loop through multiple items in your template by wrapping them as follows:
        <blockquote>
          {#items} {name} {count} {value} {total} {/items}
          </blockquote>
          <br /> We can also handle cost displays through the following tags:
          <ul>
            <li>{running} - The purchase order total value before VAT</li>
            <li>{vat} - The amount of VAT to pay on this purchase order </li>
            <li>{total} - The total purchase order cost</li>
          </ul>
          <br /> All calculations are carried out by RealTime, so you don't need to do anything extra to generate a Purchase Order.
        </div>
      </div>
    </div>
  </div>
</template>
