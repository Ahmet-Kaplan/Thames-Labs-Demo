machine:
  java:
    version: oraclejdk8
  node:
    version: 5.2.0
  environment:
    CUCUMBER_JSON_OUTPUT: $CIRCLE_TEST_REPORTS/cucumber/chrome.cucumber
    SERVER_TEST_REPORTER: junit
    CLIENT_TEST_REPORTER: json
    MOCHA_FILE: $CIRCLE_TEST_REPORTS/server.xml
    MOCHA_FILE_CLIENT: $CIRCLE_TEST_REPORTS/client.xml
  post:
    - env

general:
  artifacts:
    - $CIRCLE_TEST_REPORTS
    - target

dependencies:
  cache_directories:
    - ~/.meteor
    - ~/node_modules
  override:
    - meteor || curl https://install.meteor.com/ | sh
    - meteor npm install
    - npm install glob

test:
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
  override:
    - npm run lint
    - MOCHA_FILE=$CIRCLE_TEST_REPORTS/unit-test-server.xml MOCHA_FILE_CLIENT=$CIRCLE_TEST_REPORTS/unit-test-client.xml npm run unit-test
    - MOCHA_FILE=$CIRCLE_TEST_REPORTS/full-app-test-server.xml MOCHA_FILE_CLIENT=$CIRCLE_TEST_REPORTS/full-app-test-client.xml npm run full-app-test
    - npm run circle