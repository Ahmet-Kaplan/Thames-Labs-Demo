machine:
  java:
    version: oraclejdk8
  node:
    version: 5.2.0
  environment:
    CUCUMBER_JSON_OUTPUT: $CIRCLE_TEST_REPORTS/cucumber/tests.cucumber
  post:
    - env
    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
general:
  artifacts:
    - $CIRCLE_TEST_REPORTS
    - target
dependencies:
  cache_directories:
    - "node_modules"
    - "~/.npm"
    - "~/_opt"
    - ~/.meteor
  override:
    - curl https://install.meteor.com/ | sh
    - npm install
    - npm install glob
test:
  override: 
    - GIT_COMMIT_MESSAGE=$(git log --format=%B -n 1 $CIRCLE_SHA1) && if [[ ! -z "$CI_PULL_REQUEST" ]] || [[ "$CIRCLE_BRANCH" == "master" ]] || [[ "$GIT_COMMIT_MESSAGE" == *"[run-tests]"* ]]; then npm run circle; else npm run lint; fi