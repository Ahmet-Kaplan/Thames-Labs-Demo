<template name="salesPipeline">
    {{setPageTitle "Sales Pipeline"}}

    <div class="row list-header">
        <div class="col-md-8">
            <h1>Sales Pipeline</h1>
            <div>{{> filterPanel collectionName='opportunities' single='opportunity'}}</div>
            <div id="d3-sales-pipeline"></div>
        </div>
        <div class="col-md-4">
            {{#if selectedOpportunity}}
                <h2>{{selectedOpportunity.name}}</h2>
                <p class="pull-right">
                  {{> opportunityPreviousStageButton opportunity=selectedOpportunity}}
                  {{> opportunityNextStageButton opportunity=selectedOpportunity}}
                </p>
                <div class="clearfix"></div>
                <p class="pull-right">
                  {{> opportunityLostLink opportunity=selectedOpportunity}}
                </p>
                <div class="clearfix"></div>
                {{> tagInput tags=selectedOpportunity.tags collection='opportunities' entityId=selectedOpportunity._id permissionToEdit='CanEditOpportunities'}}
                {{> opportunityDetailsPanel opportunity=selectedOpportunity}}
            {{else}}
                <br>
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h4>Select an opportunity to view details</h4>
                    </div>
                </div>
            {{/if}}
        </div>
    </div>
</template>